<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Pertokoan</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #8a0303;
            color: #f5f5f5;
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 250px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            transition: transform 0.3s ease;
            z-index: 1000;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            overflow-y: auto;
            display: none;
        }
        
        .sidebar.hidden {
            transform: translateX(-100%);
        }
        
        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar-menu {
            padding: 15px 0;
        }
        
        .sidebar-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sidebar-item:hover, .sidebar-item.active {
            background: rgba(255,255,255,0.1);
        }
        
        .sidebar-item i {
            width: 20px;
            text-align: center;
        }
        
        /* Tambahan style untuk sidebar export buttons */
        .sidebar-export-buttons {
            padding: 15px 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: 10px;
        }
        
        .sidebar-export-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .sidebar-export-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .sidebar-export-btn i {
            width: 20px;
            text-align: center;
        }
        
        .sidebar-export-section {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar-export-section h4 {
            margin-bottom: 10px;
            font-size: 14px;
            opacity: 0.8;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 0;
            transition: margin-left 0.3s ease;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            width: 100%;
        }
        
        .main-content.with-sidebar {
            margin-left: 250px;
        }
        
        .main-content.expanded {
            margin-left: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
            width: 100%;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 0;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .menu-toggle {
            position: absolute;
            left: 15px;
            top: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: none;
        }
        
        .menu-toggle:hover {
            background: rgba(255,255,255,0.4);
        }
        
        .user-info {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-info span {
            font-size: 14px;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.4);
        }
        
        nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 5px;
        }
        
        .nav-btn:hover, .nav-btn.active {
            background: rgba(255,255,255,0.4);
            transform: translateY(-2px);
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            animation: fadeIn 0.5s ease-in-out;
            width: 100%;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: inline-block;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid #667eea;
            color: #667eea;
        }
        
        .btn-outline:hover {
            background: #667eea;
            color: white;
        }
        
        /* Table Styles */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            width: 100%;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            min-width: 600px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        /* Status Badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-available {
            background: #d4edda;
            color: #155724;
        }
        
        .status-low {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-out {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-completed {
            background: #d4edda;
            color: #155724;
        }
        
        /* Card Styles */
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            width: 100%;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #28a745;
            color: white;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: #dc3545;
        }
        
        /* Chart Container */
        .chart-container {
            height: 300px;
            margin-top: 20px;
            width: 100%;
        }
        
        /* Login Screen */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 100%;
        }
        
        .login-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }
        
        .login-card h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        
        .login-btn {
            width: 100%;
            margin-top: 10px;
        }
        
        /* Utility Classes */
        .form-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .form-row .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        .mt-4 {
            margin-top: 20px;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .supplier-container {
            display: flex;
            gap: 10px;
            align-items: flex-end;
            flex-wrap: wrap;
        }
        
        .supplier-container .form-group {
            flex: 1;
            margin-bottom: 0;
            min-width: 200px;
        }
        
        .supplier-container .btn {
            margin-bottom: 0;
        }
        
        .hidden {
            display: none;
        }
        
        .price-info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .price-info p {
            margin: 5px 0;
            color: #0066cc;
        }
        
        /* Editable Field */
        .editable-field {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .editable-field input {
            width: auto;
            flex: 1;
        }
        
        /* User Management */
        .user-role-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .role-owner {
            background: #d4edda;
            color: #155724;
        }
        
        .role-kasir {
            background: #cce7ff;
            color: #004085;
        }
        
        .role-manager {
            background: #fff3cd;
            color: #856404;
        }
        
        /* Search Box */
        .search-box {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 100%;
        }
        
        /* Dark Mode */
        body.dark-mode {
            background-color: #1a1a1a;
            color: #ffffff;
        }
        
        body.dark-mode .card,
        body.dark-mode .tab-content {
            background-color: #2d2d2d;
            color: #ffffff;
        }
        
        body.dark-mode table {
            background-color: #2d2d2d;
            color: #ffffff;
        }
        
        body.dark-mode th {
            background-color: #3d3d3d;
            color: #ffffff;
        }
        
        body.dark-mode input,
        body.dark-mode select,
        body.dark-mode textarea {
            background-color: #3d3d3d;
            color: #ffffff;
            border-color: #555;
        }
        
        body.dark-mode .sidebar {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
        }
        
        body.dark-mode header {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                transform: translateX(-100%);
            }
            
            .sidebar.hidden {
                transform: translateX(0);
            }
            
            .main-content.with-sidebar {
                margin-left: 0;
            }
            
            .main-content.expanded {
                margin-left: 0;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .form-row .form-group {
                min-width: 100%;
            }
            
            .supplier-container {
                flex-direction: column;
            }
            
            .supplier-container .form-group {
                min-width: 100%;
            }
            
            .user-info {
                position: static;
                justify-content: center;
                margin-top: 10px;
            }
            
            nav {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-btn {
                width: 100%;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <h2><i class="fas fa-store"></i> Login Aplikasi Pertokoan</h2>
            <div class="form-group">
                <label>Username:</label>
                <input type="text" id="username" placeholder="Masukkan username">
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="password" placeholder="Masukkan password">
            </div>
            <button id="loginBtn" class="btn login-btn">Login</button>
        </div>
    </div>

    <!-- Sidebar Menu - Awalnya disembunyikan -->
    <div id="sidebar" class="sidebar hidden">
        <div class="sidebar-header">
            <h2><i class="fas fa-store"></i> TokoKu</h2>
            <p>Sistem Manajemen</p>
        </div>
        <div class="sidebar-menu">
            <div class="sidebar-item active" onclick="showTab('purchase')">
                <i class="fas fa-shopping-cart"></i>
                <span>Pembelian</span>
            </div>
            <div class="sidebar-item" onclick="showTab('inventory')">
                <i class="fas fa-boxes"></i>
                <span>Persediaan</span>
            </div>
            <div class="sidebar-item" onclick="showTab('sales')">
                <i class="fas fa-cash-register"></i>
                <span>Penjualan</span>
            </div>
            <div class="sidebar-item" onclick="showTab('finance')">
                <i class="fas fa-chart-line"></i>
                <span>Keuangan</span>
            </div>
            <div class="sidebar-item" onclick="showTab('profit')">
                <i class="fas fa-calculator"></i>
                <span>Laba/Rugi</span>
            </div>
            <div class="sidebar-item" onclick="showTab('users')">
                <i class="fas fa-users"></i>
                <span>Manajemen User</span>
            </div>
            
            <!-- Export/Import Section di Sidebar -->
            <div class="sidebar-export-buttons">
                <!-- Dark Mode Button - Tersedia untuk semua user -->
                <button class="sidebar-export-btn" onclick="toggleDarkMode()">
                    <i class="fas fa-moon"></i>
                    <span>Mode Gelap</span>
                </button>
                
                <!-- Excel Export - Tersedia untuk semua user -->
                <button class="sidebar-export-btn" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i>
                    <span>Export Excel</span>
                </button>
                
                <!-- Section khusus untuk Owner -->
                <div id="ownerExportSection" class="sidebar-export-section hidden">
                    <h4>Admin Tools</h4>
                    <button class="sidebar-export-btn" onclick="exportData()">
                        <i class="fas fa-download"></i>
                        <span>Export JSON</span>
                    </button>
                    
                    <label for="importFile" class="sidebar-export-btn" style="cursor: pointer; margin-bottom: 0;">
                        <i class="fas fa-upload"></i>
                        <span>Import Data</span>
                    </label>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application - Awalnya disembunyikan -->
    <div id="app" class="main-content" style="display: none;">
        <div class="container">
            <header>
                <button class="menu-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <h1><i class="fas fa-store"></i> Aplikasi Pertokoan</h1>
                <p>Sistem Manajemen Toko Terintegrasi</p>
                <div class="user-info">
                    <!-- Tombol di header hanya untuk logout dan info user -->
                    <span id="currentUser">User</span>
                    <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
                </div>
                <nav>
                    <button class="nav-btn" onclick="showTab('purchase')" id="purchaseBtn"><i class="fas fa-shopping-cart"></i> Pembelian</button>
                    <button class="nav-btn" onclick="showTab('inventory')" id="inventoryBtn"><i class="fas fa-boxes"></i> Persediaan</button>
                    <button class="nav-btn active" onclick="showTab('sales')" id="salesBtn"><i class="fas fa-cash-register"></i> Penjualan</button>
                    <button class="nav-btn" onclick="showTab('finance')" id="financeBtn"><i class="fas fa-chart-line"></i> Keuangan</button>
                    <button class="nav-btn" onclick="showTab('profit')" id="profitBtn"><i class="fas fa-calculator"></i> Laba/Rugi</button>
                    <button class="nav-btn" onclick="showTab('users')" id="usersBtn"><i class="fas fa-users"></i> User</button>
                </nav>
            </header>

            <!-- Tab Pembelian -->
            <div id="purchase" class="tab-content">
                <h2><i class="fas fa-shopping-cart"></i> Rencana & Pembelian</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalPurchaseMonth">Rp 0</div>
                        <div class="stat-label">Total Belanja Bulan Ini</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalPOItems">0</div>
                        <div class="stat-label">Item dalam PO</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeSuppliers">0</div>
                        <div class="stat-label">Supplier Aktif</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Rencana Pembelian</h3>
                    <form id="purchasePlanForm">
                        <div class="form-group">
                            <label>Nama Produk:</label>
                            <input type="text" id="productName" placeholder="Masukkan nama produk" oninput="checkExistingProduct()">
                            <div id="productInfo" class="price-info hidden">
                                <p id="existingProductInfo"></p>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Kuantitas:</label>
                                <input type="number" id="quantity" placeholder="Jumlah yang dibeli" min="1">
                            </div>
                            <div class="form-group">
                                <label>Harga Satuan:</label>
                                <input type="number" id="unitPrice" placeholder="Harga per unit" min="0" step="0.01">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Supplier:</label>
                            <div class="supplier-container">
                                <div class="form-group">
                                    <select id="supplierSelect" onchange="handleSupplierSelect()">
                                        <option value="">Pilih Supplier</option>
                                        <option value="PT. Distributor ABC">PT. Distributor ABC</option>
                                        <option value="CV. Maju Sejahtera">CV. Maju Sejahtera</option>
                                        <option value="UD. Makmur Jaya">UD. Makmur Jaya</option>
                                        <option value="other">+ Tambah Supplier Baru</option>
                                    </select>
                                    <input type="text" id="supplierInput" class="hidden" placeholder="Masukkan nama supplier">
                                </div>
                                <button type="button" class="btn btn-outline" onclick="toggleSupplierInput()" id="toggleSupplierBtn">
                                    <i class="fas fa-edit"></i> Manual
                                </button>
                            </div>
                        </div>
                        <button type="submit" class="btn"><i class="fas fa-plus-circle"></i> Tambah ke PO</button>
                    </form>
                </div>
                
                <div class="card">
                    <h3>Daftar Supplier</h3>
                    <input type="text" class="search-box" placeholder="Cari supplier..." oninput="searchTable('supplierTable', this.value)">
                    <div class="table-container">
                        <table id="supplierTable">
                            <thead>
                                <tr>
                                    <th>Nama Supplier</th>
                                    <th>Jumlah PO</th>
                                    <th>Total Nilai PO</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Purchase Orders Aktif</h3>
                    <input type="text" class="search-box" placeholder="Cari PO..." oninput="searchTable('poTable', this.value)">
                    <div class="table-container">
                        <table id="poTable">
                            <thead>
                                <tr>
                                    <th>No. PO</th>
                                    <th>Tanggal</th>
                                    <th>Produk</th>
                                    <th>Supplier</th>
                                    <th>Kuantitas</th>
                                    <th>Harga Satuan</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Tab Persediaan -->
            <div id="inventory" class="tab-content">
                <h2><i class="fas fa-boxes"></i> Manajemen Persediaan</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalInventoryItems">0</div>
                        <div class="stat-label">Total Item Persediaan</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="lowStockItems">0</div>
                        <div class="stat-label">Item Low Stock</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalInventoryValue">Rp 0</div>
                        <div class="stat-label">Nilai Total Persediaan</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Penerimaan Barang</h3>
                    <form id="receivingForm">
                        <div class="form-group">
                            <label>Nomor PO:</label>
                            <select id="poNumber" onchange="fillReceivingForm()">
                                <option value="">Pilih Nomor PO</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nama Produk:</label>
                            <input type="text" id="receivedProduct" placeholder="Nama produk yang diterima" readonly>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Kuantitas PO:</label>
                                <input type="number" id="poQuantity" placeholder="Jumlah yang dipesan" readonly>
                            </div>
                            <div class="form-group">
                                <label>Kuantitas Diterima:</label>
                                <input type="number" id="receivedQuantity" placeholder="Jumlah yang diterima" min="1">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Harga Beli dari PO:</label>
                                <input type="number" id="poBuyPrice" placeholder="Harga beli dari PO" readonly>
                            </div>
                            <div class="form-group">
                                <label>Harga Jual Baru:</label>
                                <input type="number" id="newSellPriceReceiving" placeholder="Harga jual baru" min="0" step="0.01">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Kualitas:</label>
                            <select id="quality">
                                <option value="good">Baik</option>
                                <option value="damaged">Rusak</option>
                                <option value="expired">Kadaluwarsa</option>
                            </select>
                        </div>
                        <button type="submit" class="btn"><i class="fas fa-check-circle"></i> Konfirmasi Penerimaan</button>
                    </form>
                </div>
                
                <div class="card">
                    <h3>Stok Produk</h3>
                    <input type="text" class="search-box" placeholder="Cari produk..." oninput="searchTable('stockTable', this.value)">
                    <div class="table-container">
                        <table id="stockTable">
                            <thead>
                                <tr>
                                    <th>Produk</th>
                                    <th>Stok</th>
                                    <th>Harga Beli</th>
                                    <th>Harga Jual</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Tab Penjualan -->
            <div id="sales" class="tab-content active">
                <h2><i class="fas fa-cash-register"></i> Penjualan</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="todayTransactions">0</div>
                        <div class="stat-label">Transaksi Hari Ini</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="todaySales">Rp 0</div>
                        <div class="stat-label">Penjualan Hari Ini</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeCustomers">0</div>
                        <div class="stat-label">Pelanggan Aktif</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Proses Penjualan</h3>
                    <form id="saleForm">
                        <div class="form-group">
                            <label>Produk:</label>
                            <select id="soldProduct">
                                <option value="">Pilih Produk</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Kuantitas:</label>
                                <input type="number" id="soldQuantity" placeholder="Jumlah terjual" min="1">
                            </div>
                            <div class="form-group">
                                <label>Diskon (%):</label>
                                <input type="number" id="discount" placeholder="Diskon" min="0" max="100" value="0">
                            </div>
                        </div>
                        <button type="submit" class="btn"><i class="fas fa-shopping-bag"></i> Tambah ke Transaksi</button>
                    </form>
                    
                    <div class="card mt-4">
                        <h4>Detail Transaksi Saat Ini</h4>
                        <div id="transactionDetails"></div>
                        <div style="margin-top: 15px;">
                            <span style="font-weight: bold;">Subtotal: </span><span id="subtotal">Rp 0</span><br>
                            <span style="font-weight: bold;">Diskon: </span><span id="discountAmount">Rp 0</span><br>
                            <span style="font-weight: bold;">Total: </span><span id="totalAmount">Rp 0</span>
                        </div>
                        <div class="action-buttons" style="margin-top: 15px;">
                            <button type="button" class="btn btn-secondary" onclick="clearTransaction()">
                                <i class="fas fa-times"></i> Batalkan Transaksi
                            </button>
                            <button type="button" class="btn btn-success" onclick="completeTransaction()">
                                <i class="fas fa-check-double"></i> Selesaikan Transaksi
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Riwayat Penjualan</h3>
                    <input type="text" class="search-box" placeholder="Cari penjualan..." oninput="searchTable('salesTable', this.value)">
                    <div class="table-container">
                        <table id="salesTable">
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Produk</th>
                                    <th>Jumlah</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th id="salesActionHeader" class="hidden">Aksi</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Tab Keuangan -->
            <div id="finance" class="tab-content">
                <h2><i class="fas fa-chart-line"></i> Keuangan</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="cashBalance">Rp 0</div>
                        <div class="stat-label">Saldo Kas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="customerReceivables">Rp 0</div>
                        <div class="stat-label">Piutang Pelanggan</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="supplierPayables">Rp 0</div>
                        <div class="stat-label">Hutang Supplier</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Pemasukan</h3>
                    <form id="incomeForm">
                        <div class="form-group">
                            <label>Sumber Dana:</label>
                            <select id="incomeSource">
                                <option value="sales">Penjualan</option>
                                <option value="investment">Investasi</option>
                                <option value="loan">Pinjaman</option>
                                <option value="other">Lainnya</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Jumlah:</label>
                            <input type="number" id="incomeAmount" placeholder="Jumlah pemasukan" min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Keterangan:</label>
                            <textarea id="incomeDescription" rows="3" placeholder="Deskripsi pemasukan"></textarea>
                        </div>
                        <button type="submit" class="btn"><i class="fas fa-plus"></i> Catat Pemasukan</button>
                    </form>
                </div>
                
                <div class="card">
                    <h3>Pengeluaran</h3>
                    <form id="expenseForm">
                        <div class="form-group">
                            <label>Jenis Pengeluaran:</label>
                            <select id="expenseType">
                                <option value="purchase">Pembelian Barang</option>
                                <option value="operational">Operasional</option>
                                <option value="salary">Gaji Karyawan</option>
                                <option value="utility">Tagihan Utilitas</option>
                                <option value="other">Lainnya</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Jumlah:</label>
                            <input type="number" id="expenseAmount" placeholder="Jumlah pengeluaran" min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Keterangan:</label>
                            <textarea id="expenseDescription" rows="3" placeholder="Deskripsi pengeluaran"></textarea>
                        </div>
                        <button type="submit" class="btn btn-danger"><i class="fas fa-minus"></i> Catat Pengeluaran</button>
                    </form>
                </div>
                
                <div class="card">
                    <h3>Biaya Utilitas</h3>
                    <form id="utilityForm">
                        <div class="form-group">
                            <label>Jenis Utilitas:</label>
                            <select id="utilityType">
                                <option value="electricity">Listrik</option>
                                <option value="water">Air</option>
                                <option value="internet">Internet</option>
                                <option value="phone">Telepon</option>
                                <option value="rent">Sewa</option>
                                <option value="other">Lainnya</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Periode:</label>
                            <input type="month" id="utilityPeriod">
                        </div>
                        <div class="form-group">
                            <label>Jumlah:</label>
                            <input type="number" id="utilityAmount" placeholder="Jumlah biaya utilitas" min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>Keterangan:</label>
                            <textarea id="utilityDescription" rows="3" placeholder="Deskripsi biaya utilitas"></textarea>
                        </div>
                        <button type="submit" class="btn btn-danger"><i class="fas fa-bolt"></i> Catat Biaya Utilitas</button>
                    </form>
                </div>
                
                <div class="card">
                    <h3>Laporan Keuangan</h3>
                    <div class="chart-container">
                        <canvas id="financeChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Tab Laba/Rugi -->
            <div id="profit" class="tab-content">
                <h2><i class="fas fa-calculator"></i> Perhitungan Laba/Rugi</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalRevenue">Rp 0</div>
                        <div class="stat-label">Total Pendapatan</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalCost">Rp 0</div>
                        <div class="stat-label">Total Biaya</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="netProfit">Rp 0</div>
                        <div class="stat-label">Laba Bersih</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Hitung Laba/Rugi</h3>
                    <form id="profitForm">
                        <div class="form-group">
                            <label>Periode:</label>
                            <select id="period">
                                <option value="daily">Harian</option>
                                <option value="weekly">Mingguan</option>
                                <option value="monthly">Bulanan</option>
                                <option value="yearly">Tahunan</option>
                            </select>
                        </div>
                        <button type="submit" class="btn"><i class="fas fa-chart-pie"></i> Hitung Laba</button>
                    </form>
                </div>
                
                <div class="card">
                    <h3>Ringkasan Laba/Rugi</h3>
                    <div class="table-container">
                        <table id="profitTable">
                            <thead>
                                <tr>
                                    <th>Komponen</th>
                                    <th>Jumlah (Rp)</th>
                                    <th>Persen (%)</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Total Pendapatan Penjualan</td>
                                    <td id="profitTotalRevenue">0</td>
                                    <td id="revenuePercent">0%</td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td>Biaya Beli Barang</td>
                                    <td id="profitCostOfGoodsSold">0</td>
                                    <td id="cogsPercent">0%</td>
                                    <td>
                                        <button class="btn btn-small btn-secondary" onclick="editCost('cogs')">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Biaya Operasional</td>
                                    <td id="profitOperationalCost">0</td>
                                    <td id="opexPercent">0%</td>
                                    <td>
                                        <button class="btn btn-small btn-secondary" onclick="editCost('operational')">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Biaya Gaji Karyawan</td>
                                    <td id="profitSalaryCost">0</td>
                                    <td id="salaryPercent">0%</td>
                                    <td>
                                        <button class="btn btn-small btn-secondary" onclick="editCost('salary')">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Biaya Utilitas</td>
                                    <td id="profitUtilityCost">0</td>
                                    <td id="utilityPercent">0%</td>
                                    <td>
                                        <button class="btn btn-small btn-secondary" onclick="editCost('utility')">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Biaya Lain-lain</td>
                                    <td id="profitOtherCost">0</td>
                                    <td id="otherPercent">0%</td>
                                    <td>
                                        <button class="btn btn-small btn-secondary" onclick="editCost('other')">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>Total Biaya</strong></td>
                                    <td id="profitTotalCost">0</td>
                                    <td id="totalCostPercent">0%</td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td><strong>Laba/Rugi Bersih</strong></td>
                                    <td id="profitNetProfit">0</td>
                                    <td id="netProfitPercent">0%</td>
                                    <td>-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Grafik Laba/Rugi</h3>
                    <div class="chart-container">
                        <canvas id="profitChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Tab Manajemen User -->
            <div id="users" class="tab-content">
                <h2><i class="fas fa-users"></i> Manajemen User</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalUsers">0</div>
                        <div class="stat-label">Total User</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeUsers">0</div>
                        <div class="stat-label">User Aktif</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="adminUsers">0</div>
                        <div class="stat-label">User Admin</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Tambah User Baru</h3>
                    <form id="userForm">
                        <div class="form-group">
                            <label>Nama Lengkap:</label>
                            <input type="text" id="fullName" placeholder="Masukkan nama lengkap">
                        </div>
                        <div class="form-group">
                            <label>Username:</label>
                            <input type="text" id="newUsername" placeholder="Masukkan username">
                        </div>
                        <div class="form-group">
                            <label>Password:</label>
                            <input type="password" id="newPassword" placeholder="Masukkan password">
                        </div>
                        <div class="form-group">
                            <label>Konfirmasi Password:</label>
                            <input type="password" id="confirmPassword" placeholder="Konfirmasi password">
                        </div>
                        <div class="form-group">
                            <label>Role:</label>
                            <select id="userRoleSelect">
                                <option value="kasir">Kasir</option>
                                <option value="owner">Owner</option>
                                <option value="manager">Manager</option>
                            </select>
                        </div>
                        <button type="submit" class="btn"><i class="fas fa-user-plus"></i> Tambah User</button>
                    </form>
                </div>
                
                <div class="card">
                    <h3>Daftar User</h3>
                    <input type="text" class="search-box" placeholder="Cari user..." oninput="searchTable('usersTable', this.value)">
                    <div class="table-container">
                        <table id="usersTable">
                            <thead>
                                <tr>
                                    <th>Nama</th>
                                    <th>Username</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <script>
        // Data storage
        let purchaseOrders = [];
        let inventory = [];
        let salesTransactions = [];
        let incomeRecords = [];
        let expenseRecords = [];
        let utilityRecords = [];
        let suppliers = [];
        let users = [];
        
        // Current transaction items
        let currentTransactionItems = [];
        
        // Current user
        let currentUser = null;

        // Auto-refresh system
        let autoRefreshInterval;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Set up login
            document.getElementById('loginBtn').addEventListener('click', login);
            
            // Load sample data for demonstration
            loadSampleData();
            
            // Setup form event listeners
            setupFormListeners();
            
            // Setup real-time data monitoring
            setupRealtimeListeners();
            
            // Load saved data
            loadAutoSave();
            
            // Handle responsive design
            handleResize();
            
            // Load dark mode preference
            loadDarkModePreference();
        });

        // Setup form event listeners
        function setupFormListeners() {
            // Income form
            document.getElementById('incomeForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const source = document.getElementById('incomeSource').value;
                const amount = parseFloat(document.getElementById('incomeAmount').value);
                const description = document.getElementById('incomeDescription').value;
                
                if (!amount) {
                    showNotification('Harap masukkan jumlah pemasukan!', true);
                    return;
                }
                
                incomeRecords.push({
                    id: Date.now(),
                    date: new Date(),
                    source: source,
                    amount: amount,
                    description: description
                });
                
                // Update all related components
                updateAllStats();
                
                // Reset form
                this.reset();
                showNotification('Pemasukan berhasil dicatat');
            });

            // Expense form
            document.getElementById('expenseForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const type = document.getElementById('expenseType').value;
                const amount = parseFloat(document.getElementById('expenseAmount').value);
                const description = document.getElementById('expenseDescription').value;
                
                if (!amount) {
                    showNotification('Harap masukkan jumlah pengeluaran!', true);
                    return;
                }
                
                expenseRecords.push({
                    id: Date.now(),
                    date: new Date(),
                    type: type,
                    amount: amount,
                    description: description
                });
                
                // Update all related components
                updateAllStats();
                
                // Reset form
                this.reset();
                showNotification('Pengeluaran berhasil dicatat');
            });

            // Utility form
            document.getElementById('utilityForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const type = document.getElementById('utilityType').value;
                const period = document.getElementById('utilityPeriod').value;
                const amount = parseFloat(document.getElementById('utilityAmount').value);
                const description = document.getElementById('utilityDescription').value;
                
                if (!amount || !period) {
                    showNotification('Harap masukkan jumlah dan periode biaya utilitas!', true);
                    return;
                }
                
                utilityRecords.push({
                    id: Date.now(),
                    date: new Date(),
                    type: type,
                    period: period,
                    amount: amount,
                    description: description
                });
                
                // Update all related components
                updateAllStats();
                
                // Reset form
                this.reset();
                showNotification('Biaya utilitas berhasil dicatat');
            });

            // Purchase Plan Form
            document.getElementById('purchasePlanForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const productName = document.getElementById('productName').value;
                const quantity = parseInt(document.getElementById('quantity').value);
                const unitPrice = parseFloat(document.getElementById('unitPrice').value);
                
                // Get supplier from either select or input
                let supplier = '';
                const supplierSelect = document.getElementById('supplierSelect');
                const supplierInput = document.getElementById('supplierInput');
                
                if (supplierSelect.value === 'other' || supplierInput.style.display !== 'none') {
                    supplier = supplierInput.value.trim();
                    if (!supplier) {
                        showNotification('Harap masukkan nama supplier!', true);
                        return;
                    }
                    
                    // Add new supplier to list if not exists
                    if (!suppliers.includes(supplier)) {
                        suppliers.push(supplier);
                        updateSupplierSelect();
                    }
                } else {
                    supplier = supplierSelect.value;
                }
                
                if (!productName || !quantity || !unitPrice || !supplier) {
                    showNotification('Harap isi semua field!', true);
                    return;
                }
                
                const total = quantity * unitPrice;
                const poNumber = 'PO-' + (purchaseOrders.length + 1).toString().padStart(3, '0');
                
                const po = {
                    id: Date.now(),
                    poNumber: poNumber,
                    date: new Date(),
                    product: productName,
                    supplier: supplier,
                    quantity: quantity,
                    price: unitPrice,
                    total: total,
                    status: 'pending'
                };
                
                purchaseOrders.push(po);
                
                // Update all related components
                updateAllStats();
                
                // Reset form
                this.reset();
                document.getElementById('productInfo').classList.add('hidden');
                showNotification(`PO ${poNumber} untuk ${productName} berhasil ditambahkan`);
            });

            // Receiving Goods Form
            document.getElementById('receivingForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const poNumber = document.getElementById('poNumber').value;
                const receivedProduct = document.getElementById('receivedProduct').value;
                const receivedQuantity = parseInt(document.getElementById('receivedQuantity').value);
                const quality = document.getElementById('quality').value;
                const newSellPrice = parseFloat(document.getElementById('newSellPriceReceiving').value);
                
                if (!poNumber || !receivedProduct || !receivedQuantity) {
                    showNotification('Harap isi semua field!', true);
                    return;
                }
                
                // Find the PO to get the purchase price
                const po = purchaseOrders.find(p => p.poNumber === poNumber);
                if (!po) {
                    showNotification('PO tidak ditemukan!', true);
                    return;
                }
                
                const buyPrice = po.price;
                
                // Find product in inventory
                const productIndex = inventory.findIndex(item => item.name.toLowerCase() === receivedProduct.toLowerCase());
                
                if (productIndex !== -1) {
                    // Calculate weighted average price if product already exists
                    const existingProduct = inventory[productIndex];
                    const totalCost = (existingProduct.stock * existingProduct.buyPrice) + (receivedQuantity * buyPrice);
                    const totalStock = existingProduct.stock + receivedQuantity;
                    const averageBuyPrice = totalCost / totalStock;
                    
                    inventory[productIndex].stock = totalStock;
                    inventory[productIndex].buyPrice = averageBuyPrice;
                    
                    // Update sell price if provided
                    if (newSellPrice && newSellPrice > 0) {
                        inventory[productIndex].sellPrice = newSellPrice;
                    }
                } else {
                    // Create new product
                    inventory.push({
                        id: Date.now(),
                        name: receivedProduct,
                        stock: receivedQuantity,
                        buyPrice: buyPrice,
                        sellPrice: newSellPrice || (buyPrice * 1.3)
                    });
                }
                
                // Update PO status
                po.status = 'completed';
                
                // Update all related components
                updateAllStats();
                
                // Reset form
                this.reset();
                showNotification(`${receivedQuantity} unit ${receivedProduct} berhasil diterima`);
            });

            // Sale Form
            document.getElementById('saleForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const soldProduct = document.getElementById('soldProduct').value;
                const soldQuantity = parseInt(document.getElementById('soldQuantity').value);
                const discount = parseInt(document.getElementById('discount').value) || 0;
                
                if (!soldProduct || !soldQuantity) {
                    showNotification('Harap isi semua field!', true);
                    return;
                }
                
                const product = inventory.find(item => item.id == soldProduct);
                
                if (!product || product.stock < soldQuantity) {
                    showNotification('Stok tidak cukup atau produk tidak ditemukan!', true);
                    return;
                }
                
                const originalPrice = product.sellPrice;
                const discountedPrice = originalPrice * (1 - discount / 100);
                const total = discountedPrice * soldQuantity;
                
                // Add to current transaction
                currentTransactionItems.push({
                    product: product.name,
                    quantity: soldQuantity,
                    price: discountedPrice,
                    total: total
                });
                
                // Update stock
                product.stock -= soldQuantity;
                
                // Update related components
                updateStockTable();
                populateProductSelect();
                updateTransactionDetails();
                updateInventoryStats();
                
                // Reset form
                document.getElementById('soldQuantity').value = '';
                document.getElementById('discount').value = '0';
                showNotification(`${soldQuantity} unit ${product.name} berhasil ditambahkan ke transaksi`);
            });

            // Profit Calculation Form
            document.getElementById('profitForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                calculateProfit();
                showNotification('Perhitungan laba/rugi selesai');
            });

            // User Form
            document.getElementById('userForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const fullName = document.getElementById('fullName').value;
                const username = document.getElementById('newUsername').value;
                const password = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const role = document.getElementById('userRoleSelect').value;
                
                if (!fullName || !username || !password || !confirmPassword) {
                    showNotification('Harap isi semua field!', true);
                    return;
                }
                
                if (password !== confirmPassword) {
                    showNotification('Password dan konfirmasi password tidak cocok!', true);
                    return;
                }
                
                // Check if username already exists
                if (users.find(user => user.username === username)) {
                    showNotification('Username sudah digunakan!', true);
                    return;
                }
                
                // Add new user
                users.push({
                    id: Date.now(),
                    fullName: fullName,
                    username: username,
                    password: password,
                    role: role,
                    status: 'active'
                });
                
                // Update all related components
                updateAllStats();
                
                // Reset form
                this.reset();
                showNotification(`User ${fullName} berhasil ditambahkan`);
            });
        }

        // Setup real-time data monitoring
        function setupRealtimeListeners() {
            // Override array methods to trigger updates
            const arraysToMonitor = [purchaseOrders, inventory, salesTransactions, incomeRecords, expenseRecords, utilityRecords, suppliers, users];
            
            arraysToMonitor.forEach(array => {
                const originalPush = array.push;
                const originalSplice = array.splice;
                
                array.push = function(...items) {
                    const result = originalPush.apply(this, items);
                    triggerDataUpdate();
                    return result;
                };
                
                array.splice = function(...args) {
                    const result = originalSplice.apply(this, args);
                    triggerDataUpdate();
                    return result;
                };
            });
        }

        function triggerDataUpdate() {
            // Update all stats and components
            updateAllStats();
            
            // Auto-save data
            autoSave();
        }

        // Load sample data for demonstration
        function loadSampleData() {
            // Sample suppliers
            suppliers = [
                'PT. Distributor ABC',
                'CV. Maju Sejahtera',
                'UD. Makmur Jaya'
            ];
            
            // Sample products
            inventory = [
                { id: 1, name: 'Sabun Mandi', stock: 50, buyPrice: 15000, sellPrice: 20000 },
                { id: 2, name: 'Shampoo', stock: 30, buyPrice: 25000, sellPrice: 35000 },
                { id: 3, name: 'Pasta Gigi', stock: 80, buyPrice: 8000, sellPrice: 12000 },
                { id: 4, name: 'Sabun Cuci Piring', stock: 20, buyPrice: 12000, sellPrice: 18000 }
            ];
            
            // Sample purchase orders
            purchaseOrders = [
                { id: 1001, poNumber: 'PO-001', date: new Date(), product: 'Sabun Mandi', supplier: 'PT. Distributor ABC', quantity: 50, price: 15000, total: 750000, status: 'pending' },
                { id: 1002, poNumber: 'PO-002', date: new Date(), product: 'Shampoo', supplier: 'CV. Maju Sejahtera', quantity: 30, price: 25000, total: 750000, status: 'pending' }
            ];
            
            // Sample sales transactions
            salesTransactions = [
                { id: 2001, date: new Date(), items: [{ product: 'Sabun Mandi', quantity: 2, price: 20000, total: 40000 }], total: 40000, status: 'completed' }
            ];
            
            // Sample income records
            incomeRecords = [
                { id: 3001, date: new Date(), source: 'sales', amount: 40000, description: 'Penjualan produk' }
            ];
            
            // Sample expense records
            expenseRecords = [
                { id: 4001, date: new Date(), type: 'operational', amount: 50000, description: 'Biaya operasional toko' },
                { id: 4002, date: new Date(), type: 'salary', amount: 2500000, description: 'Gaji karyawan bulan Oktober' }
            ];
            
            // Sample utility records
            utilityRecords = [
                { id: 5001, date: new Date(), type: 'electricity', period: '2023-10', amount: 450000, description: 'Tagihan listrik bulan Oktober' },
                { id: 5002, date: new Date(), type: 'water', period: '2023-10', amount: 120000, description: 'Tagihan air bulan Oktober' }
            ];
            
            // Sample users
            users = [
                { id: 1, fullName: 'Admin Owner', username: 'owner', password: 'owner123', role: 'owner', status: 'active' },
                { id: 2, fullName: 'Kasir Toko', username: 'kasir', password: 'kasir123', role: 'kasir', status: 'active' },
                { id: 3, fullName: 'Manager Toko', username: 'manager', password: 'manager123', role: 'manager', status: 'active' }
            ];
        }

        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
            
            sidebar.classList.toggle('hidden');
            mainContent.classList.toggle('expanded');
        }

        // Login function with password
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showNotification('Harap masukkan username dan password!', true);
                return;
            }
            
            // Find user
            const user = users.find(u => u.username === username && u.password === password);
            
            if (!user) {
                showNotification('Username atau password salah!', true);
                return;
            }
            
            if (user.status !== 'active') {
                showNotification('Akun tidak aktif!', true);
                return;
            }
            
            currentUser = user;
            document.getElementById('currentUser').textContent = user.fullName;
            
            // Hide login screen, show app
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            
            // Show sidebar after login
            const sidebar = document.getElementById('sidebar');
            sidebar.style.display = 'block';
            sidebar.classList.remove('hidden');
            
            // Add margin to main content
            const mainContent = document.querySelector('.main-content');
            mainContent.classList.add('with-sidebar');
            
            // Show menu toggle button
            document.querySelector('.menu-toggle').style.display = 'block';
            
            // Set up UI based on user role
            setupUserInterface();
            
            // Initialize data after login
            updateAllStats();
            initializeCharts();
            
            // Start auto-refresh
            startAutoRefresh();
            
            showNotification(`Login sebagai ${user.fullName} berhasil`);
        }

        // Setup UI based on user role - MODIFIKASI: Menambahkan kontrol untuk export/import
        function setupUserInterface() {
            const purchaseBtn = document.getElementById('purchaseBtn');
            const inventoryBtn = document.getElementById('inventoryBtn');
            const financeBtn = document.getElementById('financeBtn');
            const profitBtn = document.getElementById('profitBtn');
            const usersBtn = document.getElementById('usersBtn');
            
            // Show/hide action column in sales table based on user role
            const salesActionHeader = document.getElementById('salesActionHeader');
            
            // Kontrol untuk section export/import di sidebar
            const ownerExportSection = document.getElementById('ownerExportSection');
            
            // Hide all tabs first
            purchaseBtn.style.display = 'none';
            inventoryBtn.style.display = 'none';
            financeBtn.style.display = 'none';
            profitBtn.style.display = 'none';
            usersBtn.style.display = 'none';
            
            // Hide owner export section by default
            ownerExportSection.classList.add('hidden');
            
            // Show tabs based on user role
            if (currentUser.role === 'kasir') {
                // Kasir can only see sales tab
                salesBtn.style.display = 'inline-block';
                salesActionHeader.classList.add('hidden');
                
                // Kasir tidak bisa akses export/import JSON
                ownerExportSection.classList.add('hidden');
                
                // Show only sales tab
                showTab('sales');
            } else if (currentUser.role === 'owner') {
                // Owner can see all tabs
                purchaseBtn.style.display = 'inline-block';
                inventoryBtn.style.display = 'inline-block';
                salesBtn.style.display = 'inline-block';
                financeBtn.style.display = 'inline-block';
                profitBtn.style.display = 'inline-block';
                usersBtn.style.display = 'inline-block';
                salesActionHeader.classList.remove('hidden');
                
                // Owner bisa akses semua fitur export/import
                ownerExportSection.classList.remove('hidden');
            } else if (currentUser.role === 'manager') {
                // Manager can see most tabs but not user management
                purchaseBtn.style.display = 'inline-block';
                inventoryBtn.style.display = 'inline-block';
                salesBtn.style.display = 'inline-block';
                financeBtn.style.display = 'inline-block';
                profitBtn.style.display = 'inline-block';
                salesActionHeader.classList.remove('hidden');
                
                // Manager tidak bisa akses export/import JSON
                ownerExportSection.classList.add('hidden');
            }
        }

        // Logout function
        function logout() {
            currentUser = null;
            
            // Stop auto-refresh
            stopAutoRefresh();
            
            // Hide app and sidebar, show login screen
            document.getElementById('app').style.display = 'none';
            document.getElementById('sidebar').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            
            // Reset form
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            
            showNotification('Logout berhasil');
        }

        // Sistem Auto-Refresh untuk Dashboard Realtime
        function startAutoRefresh() {
            // Hentikan interval sebelumnya jika ada
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            
            // Refresh setiap 3 detik
            autoRefreshInterval = setInterval(() => {
                const activeTab = document.querySelector('.tab-content.active').id;
                refreshActiveTab(activeTab);
            }, 3000);
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }

        function refreshActiveTab(tabId) {
            switch(tabId) {
                case 'purchase':
                    updatePurchaseStats();
                    updatePoTable();
                    updateSupplierTable();
                    break;
                case 'inventory':
                    updateInventoryStats();
                    updateStockTable();
                    break;
                case 'sales':
                    updateSalesStats();
                    updateSalesTable();
                    updateTransactionDetails();
                    break;
                case 'finance':
                    updateFinanceStats();
                    updateFinanceChart();
                    break;
                case 'profit':
                    updateProfitStats();
                    calculateProfit();
                    updateProfitChart();
                    break;
                case 'users':
                    updateUserStats();
                    updateUsersTable();
                    break;
            }
        }

        // Tab switching functionality - DIPERBAIKI
        function showTab(tabId) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.nav-btn');
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));
            sidebarItems.forEach(item => item.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            
            // Set active state for sidebar item
            const sidebarItem = document.querySelector(`.sidebar-item[onclick="showTab('${tabId}')"]`);
            if (sidebarItem) {
                sidebarItem.classList.add('active');
            }
            
            // Refresh data when switching tabs - DIPERBAIKI
            refreshActiveTab(tabId);
        }

        // Notification system
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            
            text.textContent = message;
            notification.className = `notification ${isError ? 'error' : ''} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Update all statistics - DIPERBAIKI LENGKAP
        function updateAllStats() {
            updatePurchaseStats();
            updateInventoryStats();
            updateSalesStats();
            updateFinanceStats();
            updateProfitStats();
            updateUserStats();
            
            // Update charts
            updateFinanceChart();
            updateProfitChart();
            
            // Update tables
            updatePoTable();
            updateStockTable();
            updateSalesTable();
            updateSupplierTable();
            updateUsersTable();
            
            // Update dropdowns
            populateProductSelect();
            updatePoSelect();
            updateSupplierSelect();
        }

        // Purchase stats
        function updatePurchaseStats() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthlyPurchases = purchaseOrders.filter(po => {
                const poDate = new Date(po.date);
                return poDate.getMonth() === currentMonth && poDate.getFullYear() === currentYear;
            });
            
            const totalSpent = monthlyPurchases.reduce((sum, po) => sum + po.total, 0);
            const totalItems = purchaseOrders.reduce((sum, po) => sum + po.quantity, 0);
            
            document.getElementById('totalPurchaseMonth').textContent = formatCurrency(totalSpent);
            document.getElementById('totalPOItems').textContent = totalItems;
            document.getElementById('activeSuppliers').textContent = suppliers.length;
        }

        // Inventory stats
        function updateInventoryStats() {
            const totalItems = inventory.length;
            const lowStockCount = inventory.filter(item => item.stock <= 10).length;
            const totalValue = inventory.reduce((sum, item) => sum + (item.stock * item.buyPrice), 0);
            
            document.getElementById('totalInventoryItems').textContent = totalItems;
            document.getElementById('lowStockItems').textContent = lowStockCount;
            document.getElementById('totalInventoryValue').textContent = formatCurrency(totalValue);
        }

        // Sales stats
        function updateSalesStats() {
            const today = new Date().toDateString();
            const todaySales = salesTransactions.filter(sale => new Date(sale.date).toDateString() === today);
            const totalToday = todaySales.reduce((sum, sale) => sum + sale.total, 0);
            
            // Get unique customers (for demo, we'll use transaction count)
            const uniqueCustomers = salesTransactions.length;
            
            document.getElementById('todayTransactions').textContent = todaySales.length;
            document.getElementById('todaySales').textContent = formatCurrency(totalToday);
            document.getElementById('activeCustomers').textContent = uniqueCustomers;
        }

        // PERBAIKAN: Finance stats - Perhitungan saldo kas yang benar
        function updateFinanceStats() {
            const totalIncome = incomeRecords.reduce((sum, inc) => sum + inc.amount, 0);
            const totalExpense = expenseRecords.reduce((sum, exp) => sum + exp.amount, 0);
            const totalUtility = utilityRecords.reduce((sum, util) => sum + util.amount, 0);
            
            // PERBAIKAN: Hitung saldo kas yang benar (Pemasukan - Pengeluaran - Biaya Utilitas)
            const cashBalance = totalIncome - totalExpense - totalUtility;
            
            document.getElementById('cashBalance').textContent = formatCurrency(cashBalance);
            document.getElementById('customerReceivables').textContent = formatCurrency(getTotalReceivables());
            document.getElementById('supplierPayables').textContent = formatCurrency(getTotalPayables());
        }

        // Profit stats
        function updateProfitStats() {
            const totalRevenue = getTotalRevenue();
            const totalCost = getTotalCost();
            const netProfit = totalRevenue - totalCost;
            
            document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('totalCost').textContent = formatCurrency(totalCost);
            document.getElementById('netProfit').textContent = formatCurrency(netProfit);
        }

        // User stats
        function updateUserStats() {
            const totalUsers = users.length;
            const activeUsers = users.filter(user => user.status === 'active').length;
            const adminUsers = users.filter(user => user.role === 'owner').length;
            
            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('activeUsers').textContent = activeUsers;
            document.getElementById('adminUsers').textContent = adminUsers;
        }

        // Table updates
        function updatePoTable() {
            const tbody = document.querySelector('#poTable tbody');
            tbody.innerHTML = '';
            
            purchaseOrders.forEach(po => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${po.poNumber}</td>
                    <td>${formatDate(po.date)}</td>
                    <td>${po.product}</td>
                    <td>${po.supplier}</td>
                    <td>${po.quantity}</td>
                    <td>${formatCurrency(po.price)}</td>
                    <td>${formatCurrency(po.total)}</td>
                    <td><span class="status-badge status-${po.status}">${po.status === 'pending' ? 'Menunggu' : 'Selesai'}</span></td>
                    <td>
                        <button class="btn btn-secondary btn-small" onclick="updatePoStatus('${po.poNumber}')">Konfirmasi</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateStockTable() {
            const tbody = document.querySelector('#stockTable tbody');
            tbody.innerHTML = '';
            
            inventory.forEach(item => {
                const statusClass = item.stock <= 10 ? 'status-out' : (item.stock <= 20 ? 'status-low' : 'status-available');
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.stock}</td>
                    <td>${formatCurrency(item.buyPrice)}</td>
                    <td>${formatCurrency(item.sellPrice)}</td>
                    <td><span class="status-badge ${statusClass}">${getStatusText(statusClass)}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-secondary btn-small" onclick="editProduct(${item.id})">Edit</button>
                            <button class="btn btn-danger btn-small" onclick="deleteProduct(${item.id})">Hapus</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateSalesTable() {
            const tbody = document.querySelector('#salesTable tbody');
            tbody.innerHTML = '';
            
            salesTransactions.forEach(sale => {
                const row = document.createElement('tr');
                
                // Create base row content
                let rowContent = `
                    <td>${formatDate(sale.date)}</td>
                    <td>${sale.items.map(item => item.product).join(', ')}</td>
                    <td>${sale.items.reduce((sum, item) => sum + item.quantity, 0)}</td>
                    <td>${formatCurrency(sale.total)}</td>
                    <td><span class="status-badge status-completed">Selesai</span></td>
                `;
                
                // Add delete button only for owner
                if (currentUser && currentUser.role === 'owner') {
                    rowContent += `<td>
                        <button class="btn btn-danger btn-small" onclick="deleteSalesTransaction(${sale.id})">Hapus</button>
                    </td>`;
                }
                
                row.innerHTML = rowContent;
                tbody.appendChild(row);
            });
        }

        function updateSupplierTable() {
            const tbody = document.querySelector('#supplierTable tbody');
            tbody.innerHTML = '';
            
            suppliers.forEach(supplier => {
                const supplierPOs = purchaseOrders.filter(po => po.supplier === supplier);
                const totalPOs = supplierPOs.length;
                const totalValue = supplierPOs.reduce((sum, po) => sum + po.total, 0);
                const activePOs = supplierPOs.filter(po => po.status === 'pending').length;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${supplier}</td>
                    <td>${totalPOs}</td>
                    <td>${formatCurrency(totalValue)}</td>
                    <td><span class="status-badge ${activePOs > 0 ? 'status-pending' : 'status-completed'}">${activePOs > 0 ? 'Aktif' : 'Selesai'}</span></td>
                    <td>
                        <button class="btn btn-danger btn-small" onclick="deleteSupplier('${supplier}')">Hapus</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateUsersTable() {
            const tbody = document.querySelector('#usersTable tbody');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.fullName}</td>
                    <td>${user.username}</td>
                    <td><span class="user-role-badge role-${user.role}">${user.role}</span></td>
                    <td><span class="status-badge ${user.status === 'active' ? 'status-available' : 'status-out'}">${user.status === 'active' ? 'Aktif' : 'Nonaktif'}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-secondary btn-small" onclick="editUser(${user.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-danger btn-small" onclick="deleteUser(${user.id})">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Utility functions
        function formatDate(date) {
            return new Date(date).toLocaleDateString('id-ID', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        function getStatusText(statusClass) {
            switch(statusClass) {
                case 'status-available': return 'Tersedia';
                case 'status-low': return 'Stok Rendah';
                case 'status-out': return 'Kosong';
                default: return 'Tidak Diketahui';
            }
        }

        function populateProductSelect() {
            const select = document.getElementById('soldProduct');
            select.innerHTML = '<option value="">Pilih Produk</option>';
            
            inventory.forEach(item => {
                if (item.stock > 0) {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = `${item.name} (Stok: ${item.stock}) - ${formatCurrency(item.sellPrice)}`;
                    select.appendChild(option);
                }
            });
        }

        function updatePoSelect() {
            const select = document.getElementById('poNumber');
            select.innerHTML = '<option value="">Pilih Nomor PO</option>';
            
            purchaseOrders.filter(po => po.status === 'pending').forEach(po => {
                const option = document.createElement('option');
                option.value = po.poNumber;
                option.textContent = `${po.poNumber} - ${po.product}`;
                select.appendChild(option);
            });
        }

        function fillReceivingForm() {
            const poNumber = document.getElementById('poNumber').value;
            const po = purchaseOrders.find(p => p.poNumber === poNumber);
            
            if (po) {
                document.getElementById('receivedProduct').value = po.product;
                document.getElementById('poQuantity').value = po.quantity;
                document.getElementById('receivedQuantity').value = po.quantity;
                document.getElementById('poBuyPrice').value = po.price;
                
                // Calculate suggested sell price (30% markup)
                const suggestedSellPrice = po.price * 1.3;
                document.getElementById('newSellPriceReceiving').value = Math.round(suggestedSellPrice);
            } else {
                document.getElementById('receivedProduct').value = '';
                document.getElementById('poQuantity').value = '';
                document.getElementById('receivedQuantity').value = '';
                document.getElementById('poBuyPrice').value = '';
                document.getElementById('newSellPriceReceiving').value = '';
            }
        }

        function updateTransactionDetails() {
            const container = document.getElementById('transactionDetails');
            const subtotalEl = document.getElementById('subtotal');
            const discountEl = document.getElementById('discountAmount');
            const totalEl = document.getElementById('totalAmount');
            
            if (currentTransactionItems.length === 0) {
                container.innerHTML = '<p>Tidak ada item dalam transaksi saat ini</p>';
                subtotalEl.textContent = 'Rp 0';
                discountEl.textContent = 'Rp 0';
                totalEl.textContent = 'Rp 0';
                return;
            }
            
            let detailsHtml = '<ul>';
            currentTransactionItems.forEach(item => {
                detailsHtml += `<li>${item.quantity} x ${item.product} @ ${formatCurrency(item.price)} = ${formatCurrency(item.total)}</li>`;
            });
            detailsHtml += '</ul>';
            
            container.innerHTML = detailsHtml;
            
            const subtotal = currentTransactionItems.reduce((sum, item) => sum + item.total, 0);
            const discount = Math.round(subtotal * (document.getElementById('discount').value || 0) / 100);
            const total = subtotal - discount;
            
            subtotalEl.textContent = formatCurrency(subtotal);
            discountEl.textContent = formatCurrency(discount);
            totalEl.textContent = formatCurrency(total);
        }

        // Complete Transaction
        function completeTransaction() {
            if (currentTransactionItems.length === 0) {
                showNotification('Belum ada item di transaksi!', true);
                return;
            }
            
            const totalAmount = currentTransactionItems.reduce((sum, item) => sum + item.total, 0);
            
            const sale = {
                id: Date.now(),
                date: new Date(),
                items: [...currentTransactionItems],
                total: totalAmount,
                status: 'completed'
            };
            
            salesTransactions.push(sale);
            
            // Add to income records
            incomeRecords.push({
                id: Date.now(),
                date: new Date(),
                source: 'sales',
                amount: totalAmount,
                description: 'Penjualan produk: ' + currentTransactionItems.map(item => item.product).join(', ')
            });
            
            // Clear current transaction
            currentTransactionItems = [];
            updateTransactionDetails();
            
            // Update all related components
            updateAllStats();
            
            showNotification('Transaksi selesai!');
        }

        // Clear Transaction
        function clearTransaction() {
            if (currentTransactionItems.length === 0) {
                showNotification('Tidak ada transaksi yang sedang berlangsung!', true);
                return;
            }
            
            // Restore stock for all items in current transaction
            currentTransactionItems.forEach(item => {
                const product = inventory.find(p => p.name === item.product);
                if (product) {
                    product.stock += item.quantity;
                }
            });
            
            currentTransactionItems = [];
            updateTransactionDetails();
            
            // Update related components
            updateStockTable();
            populateProductSelect();
            updateInventoryStats();
            
            showNotification('Transaksi dibatalkan');
        }

        // Business calculations
        function getTotalRevenue() {
            return salesTransactions.reduce((sum, sale) => sum + sale.total, 0);
        }

        function getTotalCost() {
            return purchaseOrders.reduce((sum, po) => sum + po.total, 0) +
                   expenseRecords.filter(exp => exp.type !== 'purchase').reduce((sum, exp) => sum + exp.amount, 0) +
                   utilityRecords.reduce((sum, util) => sum + util.amount, 0);
        }

        function getCOGS() {
            return purchaseOrders.reduce((sum, po) => sum + po.total, 0);
        }

        function getSalaryCost() {
            return expenseRecords.filter(exp => exp.type === 'salary').reduce((sum, exp) => sum + exp.amount, 0);
        }

        function getUtilityCost() {
            return utilityRecords.reduce((sum, util) => sum + util.amount, 0);
        }

        function getTotalReceivables() {
            return salesTransactions.filter(sale => sale.status === 'pending').reduce((sum, sale) => sum + sale.total, 0);
        }

        function getTotalPayables() {
            return purchaseOrders.filter(po => po.status === 'pending').reduce((sum, po) => sum + po.total, 0);
        }

        function calculateProfit() {
            const revenue = getTotalRevenue();
            const cogs = getCOGS();
            const operationalCost = expenseRecords.filter(exp => exp.type === 'operational').reduce((sum, exp) => sum + exp.amount, 0);
            const salaryCost = getSalaryCost();
            const utilityCost = getUtilityCost();
            const otherCost = expenseRecords.filter(exp => !['purchase', 'operational', 'salary', 'utility'].includes(exp.type)).reduce((sum, exp) => sum + exp.amount, 0);
            const totalCost = cogs + operationalCost + salaryCost + utilityCost + otherCost;
            const netProfit = revenue - totalCost;
            
            document.getElementById('profitTotalRevenue').textContent = formatCurrency(revenue);
            document.getElementById('profitCostOfGoodsSold').textContent = formatCurrency(cogs);
            document.getElementById('profitOperationalCost').textContent = formatCurrency(operationalCost);
            document.getElementById('profitSalaryCost').textContent = formatCurrency(salaryCost);
            document.getElementById('profitUtilityCost').textContent = formatCurrency(utilityCost);
            document.getElementById('profitOtherCost').textContent = formatCurrency(otherCost);
            document.getElementById('profitTotalCost').textContent = formatCurrency(totalCost);
            document.getElementById('profitNetProfit').textContent = formatCurrency(netProfit);
            
            // Calculate percentages
            const revenuePercent = revenue > 0 ? ((revenue - totalCost) / revenue * 100).toFixed(1) : 0;
            document.getElementById('revenuePercent').textContent = `${revenuePercent}%`;
            
            const cogsPercent = revenue > 0 ? (cogs / revenue * 100).toFixed(1) : 0;
            document.getElementById('cogsPercent').textContent = `${cogsPercent}%`;
            
            const opexPercent = revenue > 0 ? (operationalCost / revenue * 100).toFixed(1) : 0;
            document.getElementById('opexPercent').textContent = `${opexPercent}%`;
            
            const salaryPercent = revenue > 0 ? (salaryCost / revenue * 100).toFixed(1) : 0;
            document.getElementById('salaryPercent').textContent = `${salaryPercent}%`;
            
            const utilityPercent = revenue > 0 ? (utilityCost / revenue * 100).toFixed(1) : 0;
            document.getElementById('utilityPercent').textContent = `${utilityPercent}%`;
            
            const otherPercent = revenue > 0 ? (otherCost / revenue * 100).toFixed(1) : 0;
            document.getElementById('otherPercent').textContent = `${otherPercent}%`;
            
            const totalCostPercent = revenue > 0 ? (totalCost / revenue * 100).toFixed(1) : 0;
            document.getElementById('totalCostPercent').textContent = `${totalCostPercent}%`;
            
            const netProfitPercent = revenue > 0 ? (netProfit / revenue * 100).toFixed(1) : 0;
            document.getElementById('netProfitPercent').textContent = `${netProfitPercent}%`;
            
            // Update profit chart
            updateProfitChart();
        }

        // Chart initialization
        function initializeCharts() {
            // Finance chart
            const financeCtx = document.getElementById('financeChart').getContext('2d');
            window.financeChart = new Chart(financeCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Pemasukan',
                        data: [],
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Pengeluaran',
                        data: [],
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Fluktuasi Keuangan'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Profit chart
            const profitCtx = document.getElementById('profitChart').getContext('2d');
            window.profitChart = new Chart(profitCtx, {
                type: 'bar',
                data: {
                    labels: ['Pendapatan Penjualan', 'Biaya Beli Barang', 'Biaya Operasional', 'Biaya Gaji', 'Biaya Utilitas', 'Biaya Lain-lain'],
                    datasets: [{
                        label: 'Jumlah (Rp)',
                        data: [0, 0, 0, 0, 0, 0],
                        backgroundColor: ['#28a745', '#dc3545', '#ffc107', '#fd7e14', '#17a2b8', '#6c757d']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Komposisi Biaya vs Pendapatan'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Update charts with initial data
            updateFinanceChart();
            updateProfitChart();
        }

        function updateFinanceChart() {
            const dates = [...new Set([...incomeRecords, ...expenseRecords].map(record => formatDate(record.date)))].sort();
            const incomes = dates.map(date => 
                incomeRecords.filter(record => formatDate(record.date) === date)
                    .reduce((sum, record) => sum + record.amount, 0)
            );
            const expenses = dates.map(date => 
                expenseRecords.filter(record => formatDate(record.date) === date)
                    .reduce((sum, record) => sum + record.amount, 0)
            );
            
            window.financeChart.data.labels = dates;
            window.financeChart.data.datasets[0].data = incomes;
            window.financeChart.data.datasets[1].data = expenses;
            window.financeChart.update();
        }

        function updateProfitChart() {
            const revenue = getTotalRevenue();
            const cogs = getCOGS();
            const operationalCost = expenseRecords.filter(exp => exp.type === 'operational').reduce((sum, exp) => sum + exp.amount, 0);
            const salaryCost = getSalaryCost();
            const utilityCost = getUtilityCost();
            const otherCost = expenseRecords.filter(exp => !['purchase', 'operational', 'salary', 'utility'].includes(exp.type)).reduce((sum, exp) => sum + exp.amount, 0);
            
            window.profitChart.data.datasets[0].data = [revenue, cogs, operationalCost, salaryCost, utilityCost, otherCost];
            window.profitChart.update();
        }

        // Additional functionality
        function toggleSupplierInput() {
            const supplierSelect = document.getElementById('supplierSelect');
            const supplierInput = document.getElementById('supplierInput');
            const toggleBtn = document.getElementById('toggleSupplierBtn');
            
            if (supplierInput.classList.contains('hidden')) {
                // Switch to manual input
                supplierSelect.classList.add('hidden');
                supplierInput.classList.remove('hidden');
                toggleBtn.innerHTML = '<i class="fas fa-list"></i> Pilih';
                supplierInput.focus();
            } else {
                // Switch back to select
                supplierSelect.classList.remove('hidden');
                supplierInput.classList.add('hidden');
                toggleBtn.innerHTML = '<i class="fas fa-edit"></i> Manual';
                supplierInput.value = '';
            }
        }

        function handleSupplierSelect() {
            const supplierSelect = document.getElementById('supplierSelect');
            if (supplierSelect.value === 'other') {
                toggleSupplierInput();
            }
        }

        function updateSupplierSelect() {
            const supplierSelect = document.getElementById('supplierSelect');
            
            // Save current value
            const currentValue = supplierSelect.value;
            
            // Remove all options except the first and the "other" option
            while (supplierSelect.children.length > 2) {
                supplierSelect.removeChild(supplierSelect.lastChild);
            }
            
            // Add supplier options
            suppliers.forEach(supplier => {
                const option = document.createElement('option');
                option.value = supplier;
                option.textContent = supplier;
                supplierSelect.appendChild(option);
            });
            
            // Restore previous value if it still exists
            if (suppliers.includes(currentValue)) {
                supplierSelect.value = currentValue;
            }
        }

        function checkExistingProduct() {
            const productName = document.getElementById('productName').value.trim();
            const productInfo = document.getElementById('productInfo');
            const existingProductInfo = document.getElementById('existingProductInfo');
            
            if (!productName) {
                productInfo.classList.add('hidden');
                return;
            }
            
            // Check if product exists in inventory
            const existingProduct = inventory.find(item => 
                item.name.toLowerCase().includes(productName.toLowerCase())
            );
            
            if (existingProduct) {
                existingProductInfo.innerHTML = `
                    <strong>Produk ditemukan:</strong> ${existingProduct.name}<br>
                    <strong>Stok saat ini:</strong> ${existingProduct.stock} unit<br>
                    <strong>Harga beli terakhir:</strong> ${formatCurrency(existingProduct.buyPrice)}<br>
                    <strong>Harga jual saat ini:</strong> ${formatCurrency(existingProduct.sellPrice)}
                `;
                productInfo.classList.remove('hidden');
                
                // Auto-fill unit price with last purchase price
                document.getElementById('unitPrice').value = existingProduct.buyPrice;
            } else {
                // Check if there are recent POs for this product
                const recentPOs = purchaseOrders
                    .filter(po => po.product.toLowerCase().includes(productName.toLowerCase()))
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
                
                if (recentPOs.length > 0) {
                    const latestPO = recentPOs[0];
                    existingProductInfo.innerHTML = `
                        <strong>Produk belum ada di inventory, tetapi ada PO sebelumnya:</strong><br>
                        <strong>PO Terakhir:</strong> ${latestPO.poNumber} (${formatDate(latestPO.date)})<br>
                        <strong>Harga beli terakhir:</strong> ${formatCurrency(latestPO.price)}<br>
                        <strong>Supplier:</strong> ${latestPO.supplier}
                    `;
                    productInfo.classList.remove('hidden');
                    
                    // Auto-fill unit price with last PO price
                    document.getElementById('unitPrice').value = latestPO.price;
                } else {
                    productInfo.classList.add('hidden');
                }
            }
        }

        function updatePoStatus(poNumber) {
            const po = purchaseOrders.find(p => p.poNumber === poNumber);
            if (po) {
                po.status = 'completed';
                
                // Update all related components
                updateAllStats();
                
                showNotification(`PO ${po.poNumber} telah dikonfirmasi`);
            }
        }

        function editProduct(id) {
            const product = inventory.find(p => p.id === id);
            if (product) {
                const newBuyPrice = prompt(`Edit harga beli untuk ${product.name}:`, product.buyPrice);
                const newSellPrice = prompt(`Edit harga jual untuk ${product.name}:`, product.sellPrice);
                
                if (newBuyPrice && !isNaN(newBuyPrice) && newSellPrice && !isNaN(newSellPrice)) {
                    product.buyPrice = parseFloat(newBuyPrice);
                    product.sellPrice = parseFloat(newSellPrice);
                    
                    // Update related components
                    updateStockTable();
                    populateProductSelect();
                    updateInventoryStats();
                    
                    showNotification(`Harga ${product.name} diperbarui`);
                }
            }
        }

        function deleteProduct(id) {
            const product = inventory.find(p => p.id === id);
            if (product) {
                const confirmDelete = confirm(`Apakah Anda yakin ingin menghapus produk ${product.name}?`);
                if (confirmDelete) {
                    inventory = inventory.filter(p => p.id !== id);
                    
                    // Update related components
                    updateAllStats();
                    
                    showNotification(`Produk ${product.name} berhasil dihapus`);
                }
            }
        }

        function deleteSalesTransaction(id) {
            const sale = salesTransactions.find(s => s.id === id);
            if (sale) {
                const confirmDelete = confirm(`Apakah Anda yakin ingin menghapus transaksi penjualan ini?`);
                if (confirmDelete) {
                    // Restore stock for all items in the transaction
                    sale.items.forEach(item => {
                        const product = inventory.find(p => p.name === item.product);
                        if (product) {
                            product.stock += item.quantity;
                        }
                    });
                    
                    // Remove the transaction
                    salesTransactions = salesTransactions.filter(s => s.id !== id);
                    
                    // Remove corresponding income record
                    incomeRecords = incomeRecords.filter(inc => 
                        !inc.description.includes(sale.items.map(item => item.product).join(','))
                    );
                    
                    // Update all related components
                    updateAllStats();
                    
                    showNotification('Transaksi penjualan berhasil dihapus');
                }
            }
        }

        function deleteSupplier(supplierName) {
            // Check if supplier has active POs
            const activePOs = purchaseOrders.filter(po => po.supplier === supplierName && po.status === 'pending');
            
            if (activePOs.length > 0) {
                showNotification(`Tidak dapat menghapus supplier ${supplierName} karena masih memiliki PO aktif!`, true);
                return;
            }
            
            const confirmDelete = confirm(`Apakah Anda yakin ingin menghapus supplier ${supplierName}?`);
            if (confirmDelete) {
                suppliers = suppliers.filter(s => s !== supplierName);
                
                // Update related components
                updateAllStats();
                
                showNotification(`Supplier ${supplierName} berhasil dihapus`);
            }
        }

        function editUser(id) {
            const user = users.find(u => u.id === id);
            if (user) {
                const newFullName = prompt(`Edit nama lengkap untuk ${user.username}:`, user.fullName);
                const newRole = prompt(`Edit role untuk ${user.username} (owner/kasir/manager):`, user.role);
                const newStatus = prompt(`Edit status untuk ${user.username} (active/inactive):`, user.status);
                
                if (newFullName && newRole && newStatus) {
                    user.fullName = newFullName;
                    user.role = newRole;
                    user.status = newStatus;
                    
                    // Update related components
                    updateAllStats();
                    
                    showNotification(`User ${user.username} berhasil diperbarui`);
                }
            }
        }

        function deleteUser(id) {
            const user = users.find(u => u.id === id);
            if (user) {
                // Prevent deleting current user
                if (currentUser && currentUser.id === id) {
                    showNotification('Tidak dapat menghapus user yang sedang login!', true);
                    return;
                }
                
                const confirmDelete = confirm(`Apakah Anda yakin ingin menghapus user ${user.fullName}?`);
                if (confirmDelete) {
                    users = users.filter(u => u.id !== id);
                    
                    // Update related components
                    updateAllStats();
                    
                    showNotification(`User ${user.fullName} berhasil dihapus`);
                }
            }
        }

        function editCost(costType) {
            let currentValue = 0;
            let costName = '';
            
            switch(costType) {
                case 'cogs':
                    currentValue = getCOGS();
                    costName = 'Biaya Beli Barang';
                    break;
                case 'operational':
                    currentValue = expenseRecords.filter(exp => exp.type === 'operational').reduce((sum, exp) => sum + exp.amount, 0);
                    costName = 'Biaya Operasional';
                    break;
                case 'salary':
                    currentValue = getSalaryCost();
                    costName = 'Biaya Gaji Karyawan';
                    break;
                case 'utility':
                    currentValue = getUtilityCost();
                    costName = 'Biaya Utilitas';
                    break;
                case 'other':
                    currentValue = expenseRecords.filter(exp => !['purchase', 'operational', 'salary', 'utility'].includes(exp.type)).reduce((sum, exp) => sum + exp.amount, 0);
                    costName = 'Biaya Lain-lain';
                    break;
            }
            
            const newValue = prompt(`Edit ${costName}:`, currentValue);
            
            if (newValue && !isNaN(newValue)) {
                const amount = parseFloat(newValue);
                
                // Update the corresponding records
                switch(costType) {
                    case 'cogs':
                        expenseRecords.push({
                            id: Date.now(),
                            date: new Date(),
                            type: 'purchase',
                            amount: amount - currentValue,
                            description: `Penyesuaian ${costName}`
                        });
                        break;
                    case 'operational':
                        expenseRecords.push({
                            id: Date.now(),
                            date: new Date(),
                            type: 'operational',
                            amount: amount - currentValue,
                            description: `Penyesuaian ${costName}`
                        });
                        break;
                    case 'salary':
                        expenseRecords.push({
                            id: Date.now(),
                            date: new Date(),
                            type: 'salary',
                            amount: amount - currentValue,
                            description: `Penyesuaian ${costName}`
                        });
                        break;
                    case 'utility':
                        utilityRecords.push({
                            id: Date.now(),
                            date: new Date(),
                            type: 'other',
                            period: new Date().toISOString().slice(0, 7),
                            amount: amount - currentValue,
                            description: `Penyesuaian ${costName}`
                        });
                        break;
                    case 'other':
                        expenseRecords.push({
                            id: Date.now(),
                            date: new Date(),
                            type: 'other',
                            amount: amount - currentValue,
                            description: `Penyesuaian ${costName}`
                        });
                        break;
                }
                
                // Recalculate profit and update all components
                updateAllStats();
                
                showNotification(`${costName} berhasil diperbarui`);
            }
        }

        // Search functionality
        function searchTable(tableId, searchTerm) {
            const table = document.getElementById(tableId);
            const rows = table.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm.toLowerCase()) ? '' : 'none';
            });
        }

        // PERBAIKAN: Export to Excel - TAMBAHAN: Cek role user
        function exportToExcel() {
            // Cek apakah user memiliki akses
            if (!currentUser) {
                showNotification('Harap login terlebih dahulu!', true);
                return;
            }
            
            // Semua role bisa export Excel
            try {
                // Create workbook
                const workbook = XLSX.utils.book_new();
                
                // Worksheet untuk Purchase Orders
                const poData = purchaseOrders.map(po => ({
                    'No. PO': po.poNumber,
                    'Tanggal': formatDate(po.date),
                    'Produk': po.product,
                    'Supplier': po.supplier,
                    'Kuantitas': po.quantity,
                    'Harga Satuan': po.price,
                    'Total': po.total,
                    'Status': po.status === 'pending' ? 'Menunggu' : 'Selesai'
                }));
                if (poData.length > 0) {
                    const poWorksheet = XLSX.utils.json_to_sheet(poData);
                    XLSX.utils.book_append_sheet(workbook, poWorksheet, 'Purchase Orders');
                }
                
                // Worksheet untuk Inventory
                const inventoryData = inventory.map(item => ({
                    'Produk': item.name,
                    'Stok': item.stock,
                    'Harga Beli': item.buyPrice,
                    'Harga Jual': item.sellPrice,
                    'Status': item.stock <= 10 ? 'Kosong' : (item.stock <= 20 ? 'Stok Rendah' : 'Tersedia')
                }));
                if (inventoryData.length > 0) {
                    const inventoryWorksheet = XLSX.utils.json_to_sheet(inventoryData);
                    XLSX.utils.book_append_sheet(workbook, inventoryWorksheet, 'Persediaan');
                }
                
                // Worksheet untuk Penjualan
                const salesData = salesTransactions.map(sale => ({
                    'Tanggal': formatDate(sale.date),
                    'Produk': sale.items.map(item => item.product).join(', '),
                    'Jumlah Total': sale.items.reduce((sum, item) => sum + item.quantity, 0),
                    'Total Penjualan': sale.total,
                    'Status': 'Selesai'
                }));
                if (salesData.length > 0) {
                    const salesWorksheet = XLSX.utils.json_to_sheet(salesData);
                    XLSX.utils.book_append_sheet(workbook, salesWorksheet, 'Penjualan');
                }
                
                // Worksheet untuk Keuangan
                const totalIncome = incomeRecords.reduce((sum, inc) => sum + inc.amount, 0);
                const totalExpense = expenseRecords.reduce((sum, exp) => sum + exp.amount, 0);
                const totalUtility = utilityRecords.reduce((sum, util) => sum + util.amount, 0);
                const cashBalance = totalIncome - totalExpense - totalUtility;
                
                const financeData = [
                    { 'Jenis': 'Total Pemasukan', 'Jumlah': totalIncome },
                    { 'Jenis': 'Total Pengeluaran', 'Jumlah': totalExpense },
                    { 'Jenis': 'Total Biaya Utilitas', 'Jumlah': totalUtility },
                    { 'Jenis': 'Saldo Kas', 'Jumlah': cashBalance },
                    { 'Jenis': 'Piutang Pelanggan', 'Jumlah': getTotalReceivables() },
                    { 'Jenis': 'Hutang Supplier', 'Jumlah': getTotalPayables() }
                ];
                const financeWorksheet = XLSX.utils.json_to_sheet(financeData);
                XLSX.utils.book_append_sheet(workbook, financeWorksheet, 'Keuangan');
                
                // Save the workbook
                const today = new Date().toISOString().split('T')[0];
                XLSX.writeFile(workbook, `laporan-toko-${today}.xlsx`);
                
                showNotification('Data berhasil diexport ke Excel');
            } catch (error) {
                showNotification('Error saat export ke Excel: ' + error.message, true);
            }
        }

        // Export/Import functionality JSON - TAMBAHAN: Cek role user
        function exportData() {
            // Hanya owner yang bisa export JSON
            if (!currentUser || currentUser.role !== 'owner') {
                showNotification('Hanya owner yang dapat melakukan export data lengkap!', true);
                return;
            }
            
            const data = {
                purchaseOrders,
                inventory,
                salesTransactions,
                incomeRecords,
                expenseRecords,
                utilityRecords,
                suppliers,
                users,
                exportDate: new Date()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `toko-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Data berhasil diexport ke JSON');
        }

        function importData(event) {
            // Hanya owner yang bisa import JSON
            if (!currentUser || currentUser.role !== 'owner') {
                showNotification('Hanya owner yang dapat melakukan import data!', true);
                return;
            }
            
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Validate data structure
                    if (data.purchaseOrders && data.inventory && data.salesTransactions) {
                        purchaseOrders = data.purchaseOrders;
                        inventory = data.inventory;
                        salesTransactions = data.salesTransactions;
                        incomeRecords = data.incomeRecords || [];
                        expenseRecords = data.expenseRecords || [];
                        utilityRecords = data.utilityRecords || [];
                        suppliers = data.suppliers || [];
                        users = data.users || [];
                        
                        // Update all components
                        updateAllStats();
                        
                        showNotification('Data berhasil diimpor');
                    } else {
                        showNotification('Format file tidak valid', true);
                    }
                } catch (error) {
                    showNotification('Error membaca file: ' + error.message, true);
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        // Auto-save functionality
        function autoSave() {
            const data = {
                purchaseOrders,
                inventory,
                salesTransactions,
                incomeRecords,
                expenseRecords,
                utilityRecords,
                suppliers,
                users,
                lastSave: new Date()
            };
            
            localStorage.setItem('tokoAppData', JSON.stringify(data));
        }

        function loadAutoSave() {
            const savedData = localStorage.getItem('tokoAppData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    
                    // Only load if data is recent (within 7 days)
                    const saveDate = new Date(data.lastSave);
                    const daysDiff = (new Date() - saveDate) / (1000 * 60 * 60 * 24);
                    
                    if (daysDiff < 7) {
                        purchaseOrders = data.purchaseOrders || [];
                        inventory = data.inventory || [];
                        salesTransactions = data.salesTransactions || [];
                        incomeRecords = data.incomeRecords || [];
                        expenseRecords = data.expenseRecords || [];
                        utilityRecords = data.utilityRecords || [];
                        suppliers = data.suppliers || [];
                        users = data.users || [];
                        
                        showNotification('Data sebelumnya berhasil dimuat');
                    }
                } catch (error) {
                    console.log('Tidak ada data tersimpan atau data korup');
                }
            }
        }

        // Set up auto-save interval
        setInterval(autoSave, 30000);

        // Responsive design
        function handleResize() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
            
            if (window.innerWidth < 768) {
                sidebar.classList.add('hidden');
                mainContent.classList.add('expanded');
            } else {
                sidebar.classList.remove('hidden');
                mainContent.classList.remove('expanded');
            }
        }

        window.addEventListener('resize', handleResize);

        // Dark mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
            showNotification('Mode ' + (document.body.classList.contains('dark-mode') ? 'gelap' : 'terang') + ' diaktifkan');
        }

        // Load dark mode preference
        function loadDarkModePreference() {
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl+S for save
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                autoSave();
                showNotification('Data disimpan');
            }
            
            // Escape to clear transaction
            if (e.key === 'Escape') {
                if (currentTransactionItems.length > 0) {
                    clearTransaction();
                }
            }
        });
    </script>
</body>
</html>
